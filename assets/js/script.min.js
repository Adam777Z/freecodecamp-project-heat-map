const projectName="heat-map";localStorage.setItem("example_project","Heat Map"),document.addEventListener("DOMContentLoaded",t=>{d3.json("./assets/json/global-temperature.json").then(t=>{const a=t.baseTemperature,e=t.monthlyVariance,r=1032,n=500,d=60;d3.select("#base-temperature").html(a);const l=d3.select("body").append("div").attr("id","tooltip"),o=d3.select("#canvas").append("svg").attr("width",r).attr("height",n),s=d3.scaleThreshold().domain(((t,a,e)=>{let r=[],n=(a-t)/e,d=t;for(let t=1;t<e;t++)r.push(d+t*n);return r})(d3.min(e.map(t=>a+t.variance)),d3.max(e.map(t=>a+t.variance)),d3.schemeRdYlBu[11].length)).range(d3.schemeRdYlBu[11].slice().reverse()),m=d3.scaleLinear().domain(d3.extent(e.map(t=>a+t.variance))).range([d,r/2-d]),i=d3.axisBottom(m).tickValues(s.domain()).tickFormat(d3.format(".1f")),c=o.append("g").attr("id","legend").attr("transform","translate("+r/4+", 0)");c.append("g").selectAll("rect").data(s.range().map(t=>{let a=s.invertExtent(t);return null==a[0]&&(a[0]=m.domain()[0]),null==a[1]&&(a[1]=m.domain()[1]),a})).enter().append("rect").attr("fill",(t,a)=>s(t[0])).attr("x",(t,a)=>m(t[0])).attr("y",16).attr("width",(t,a)=>m(t[1])-m(t[0])).attr("height",(t,a)=>20),c.append("g").attr("transform","translate(0, 36)").call(i),c.append("text").attr("transform","translate("+r/4+", 11)").style("text-anchor","middle").text("Temperature (°C)");const p=d3.scaleBand().domain(e.map(t=>t.year)).range([d,r-d]),h=d3.scaleBand().domain(d3.range(1,13)).range([n-d,d]),x=d3.scaleBand().domain(d3.range(1,13)).range([d,n-d]),y=d3.axisBottom(p).tickValues(p.domain().filter(t=>t%10==0)),g=d3.axisLeft(x).tickFormat(t=>d3.timeFormat("%B")(new Date(0,t-1)));o.append("g").attr("id","x-axis").attr("transform","translate(0, "+(n-d)+")").call(y),o.append("text").attr("transform","translate("+r/2+", "+(n-10)+")").style("text-anchor","middle").text("Year"),o.append("g").attr("id","y-axis").attr("transform","translate("+d+", 0)").call(g),o.append("text").attr("transform","rotate(-90)").attr("y",0).attr("x",0-n/2).attr("dy","1em").style("text-anchor","middle").text("Months"),o.selectAll("rect").data(e).enter().append("rect").attr("x",(t,a)=>p(t.year)).attr("y",(t,a)=>n-d/2-h(t.month)).attr("width",(t,a)=>p.bandwidth()).attr("height",(t,a)=>h.bandwidth()).attr("fill",t=>s(a+t.variance)).attr("class","cell").attr("data-year",(t,a)=>t.year).attr("data-month",(t,a)=>t.month-1).attr("data-temp",(t,e)=>a+t.variance).on("mouseover",t=>l.style("display","block").attr("data-year",t.year).text(d3.timeFormat("%Y, %B")(new Date(t.year,t.month))+", "+(a+t.variance).toFixed(3)+" °C, "+t.variance+" °C")).on("mousemove",t=>l.style("top",n+1.85*d-h(t.month)+"px").style("left",d3.event.pageX+"px")).on("mouseout",()=>l.style("display","none"))})});